<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1NESTEP | Neural Enrollment</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Space+Mono&display=swap" rel="stylesheet">

<style>
:root {
  --primary:#00d8ff;
  --error:#ff3366;
  --success:#00ff88;
  --bg:#050508;
  --transition:.5s cubic-bezier(.175,.885,.32,1.275);
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
body{height:100vh;display:flex;justify-content:center;align-items:center;background:var(--bg);overflow:hidden}
.bg-grid{position:absolute;width:100%;height:100%;z-index:-1;
background-image:linear-gradient(rgba(0,216,255,.05) 1px,transparent 1px),
linear-gradient(90deg,rgba(0,216,255,.05) 1px,transparent 1px);background-size:40px 40px}
.main-container{width:1000px;height:650px;background:rgba(255,255,255,.03);
backdrop-filter:blur(20px);border-radius:40px;display:flex;
box-shadow:0 50px 100px rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.1)}
.robot-section{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,.2);border-radius:40px 0 0 40px}
.robot-wrapper{transition:var(--transition); transform-style: preserve-3d;}
.head{width:160px;height:180px;background:#111;border:3px solid #333;border-radius:50px 50px 70px 70px;display:flex;justify-content:center;align-items:center}
.visor{width:110px;height:40px;background:#000;border-radius:10px;border:1px solid var(--primary);position:relative; overflow:hidden;}
.eye{width:25px;height:6px;background:var(--primary);position:absolute;border-radius:3px; box-shadow:0 0 15px var(--primary); top:50%; left:50%; transform: translate(-50%, -50%); animation:blinkRobot 5s infinite}
@keyframes blinkRobot{0%,96%,100%{height:6px}98%{height:.1px}}
@keyframes blinkRed{0%,100%{background:var(--error); box-shadow:0 0 15px var(--error); height:6px}50%{height:.1px}}
.status-box{margin-top:30px;font-family:Space Mono;font-size:.7rem;color:var(--primary); letter-spacing: 1px;}
.form-section{flex:1.2;padding:40px 60px;color:white;overflow-y:auto}
.form-section::-webkit-scrollbar { width: 5px; }
.form-section::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
.logo-box{text-align:center;margin-bottom:20px}
.logo-box img{max-width:180px}
.mode-toggle{display:flex;background:#111;padding:5px;border-radius:15px;margin-bottom:25px;position:relative}
.mode-toggle button{flex:1;background:none;border:none;color:#555;padding:10px;cursor:pointer;font-weight:600; z-index: 2;}
.mode-toggle button.active{color:#fff}
.toggle-blob{position:absolute;top:5px;left:5px;width:calc(50% - 5px);height:calc(100% - 10px);
background:var(--primary);border-radius:10px;transition:var(--transition); z-index: 1;}
.input-group{margin-bottom:15px}
.input-group input,.input-group select{width:100%;padding:14px;background:rgba(0,0,0,.3);
border:1px solid #333;border-radius:12px;color:white; outline: none;}
.input-group select option { background: #111; color: white; }
.auth-btn{width:100%;padding:18px;background:var(--primary);border:none;border-radius:12px;font-weight:600;cursor:pointer;}
.signup-only{display:none}
.forgot-pass {font-size: 0.7rem; color: var(--primary); cursor: pointer; text-align: right; margin-top: -10px; margin-bottom: 15px; opacity: 0.8; transition: 0.3s;}
.forgot-pass:hover {opacity: 1; text-shadow: 0 0 8px var(--primary);}
.shake{animation:shake .4s}
@keyframes shake{25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
</style>
</head>

<body>

<div class="bg-grid"></div>

<div class="main-container" id="mainCard">
  <div class="robot-section">
    <div class="robot-wrapper" id="robotWrapper">
      <div class="head">
        <div class="visor">
          <div class="eye" id="robotEye"></div>
        </div>
      </div>
    </div>
    <div class="status-box" id="statusMsg">// System_Standby</div>
  </div>

  <div class="form-section">
    <div class="logo-box">
      <img src="1nesteplogo.png" alt="Logo">
    </div>

    <div class="mode-toggle">
      <div class="toggle-blob" id="blob"></div>
      <button id="btn-login" class="active" onclick="setMode('login')">LOGIN</button>
      <button id="btn-signup" onclick="setMode('signup')">SIGN UP</button>
    </div>

    <form id="neuralForm" onsubmit="return false;">
      <div class="input-group">
        <input id="emailIn" type="email" placeholder="Email Address" autocomplete="username">
      </div>
      <div class="input-group">
        <input id="passIn" type="password" placeholder="Password" autocomplete="current-password">
      </div>

      <div id="forgotPass" class="forgot-pass" onclick="handleReset()">Forgot Password?</div>

      <div class="signup-only" id="signupFields">
        <div class="input-group"><input id="userIn" placeholder="Full Name" autocomplete="name"></div>
        <div class="input-group"><input id="phoneIn" placeholder="Phone Number" autocomplete="tel"></div>
        <div class="input-group"><input id="collegeIn" placeholder="College"></div>
        <div class="input-group"><input id="officeIn" placeholder="Office / Company"></div>
        <div class="input-group">
          <select id="roleIn">
            <option value="">Select Your Role</option>
            <option value="Student">Student</option>
            <option value="Professional">Professional</option>
            <option value="Intern">Intern</option>
          </select>
        </div>
      </div>

      <button type="submit" class="auth-btn" id="actionBtn">INITIALIZE AUTH</button>
    </form>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword, 
  sendPasswordResetEmail 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCw5pRzjfRKCm14G5Z27L_li3kbKijJR3Q",
  authDomain: "nestep-b1893.firebaseapp.com",
  projectId: "nestep-b1893",
  storageBucket: "nestep-b1893.appspot.com",
  messagingSenderId: "419529225870",
  appId: "1:419529225870:web:0d92b492dc1d458f0cfbdf"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const status = document.getElementById("statusMsg");
const actionBtn = document.getElementById("actionBtn");
const blob = document.getElementById("blob");
const eye = document.getElementById("robotEye");
const wrapper = document.getElementById("robotWrapper");
const signupFields = document.getElementById("signupFields");
const mainCard = document.getElementById("mainCard");
const neuralForm = document.getElementById("neuralForm");
const forgotLink = document.getElementById("forgotPass");

let mode = "login";

window.setMode = (m)=>{
  mode=m;
  if(m==="signup"){
    blob.style.left="50%";
    actionBtn.innerText="CREATE NEURAL ACCOUNT";
    signupFields.style.display="block";
    forgotLink.style.display="none";
  }else{
    blob.style.left="5px";
    actionBtn.innerText="INITIALIZE AUTH";
    signupFields.style.display="none";
    forgotLink.style.display="block";
  }
};

document.addEventListener("mousemove",(e)=>{
  const rect = wrapper.getBoundingClientRect();
  const centerX = rect.left + rect.width / 2;
  const centerY = rect.top + rect.height / 2;
  const x = Math.max(-40, Math.min(40, (e.clientX - centerX) / 10));
  const y = Math.max(-12, Math.min(12, (e.clientY - centerY) / 10));
  eye.style.left = `calc(50% + ${x}px)`;
  eye.style.top = `calc(50% + ${y}px)`;
});

/* FORGOT PASSWORD HANDLER */
window.handleReset = async () => {
    const email = document.getElementById("emailIn").value.trim();
    if (!email) return triggerError("Enter_Email_First");

    try {
        status.innerText = "// Dispatching_Reset_Link...";
        await sendPasswordResetEmail(auth, email);
        status.style.color = "var(--success)";
        status.innerText = "// Check_Email_For_Reset_Link";
    } catch (e) {
        triggerError("Reset_Failed");
    }
};

/* FORM SUBMISSION & VALIDATION */
neuralForm.onsubmit = async (e) => {
  e.preventDefault();
  
  const email = document.getElementById("emailIn").value.trim();
  const pass = document.getElementById("passIn").value.trim();
  const user = document.getElementById("userIn").value.trim();
  const phone = document.getElementById("phoneIn").value.trim();
  const college = document.getElementById("collegeIn").value.trim();
  const office = document.getElementById("officeIn").value.trim();
  const role = document.getElementById("roleIn").value;

  // Validation Check
  if (mode === "signup") {
    if (!email || !pass || !user || !phone || !college || !office || !role) {
      return triggerError("Incomplete_Data_Detected");
    }
  } else {
    if (!email || !pass) return triggerError("Missing_Credentials");
  }

  try {
    status.style.color = "var(--primary)";
    status.innerText = "// Processing_Neural_Link...";

    if(mode==="signup"){
      const res = await createUserWithEmailAndPassword(auth, email, pass);
      
      // Save data + password to Firestore
      await setDoc(doc(db, "users", res.user.uid), {
        username: user,
        email: email,
        password: pass, 
        phone: phone,
        college: college,
        office: office,
        role: role,
        createdAt: serverTimestamp()
      });

      status.style.color="var(--success)";
      status.innerText="// Neural_Enrollment_Complete";
    } else {
      await signInWithEmailAndPassword(auth, email, pass);
      status.style.color="var(--success)";
      status.innerText="// Login_Successful";
    }
  } catch(e) {
    triggerError(e.code.replace('auth/', ''));
  }
};

function triggerError(msg){
  mainCard.classList.add("shake");
  eye.style.animation="blinkRed .15s infinite";
  status.style.color="var(--error)";
  status.innerText="// " + msg;
  setTimeout(()=>{
    mainCard.classList.remove("shake");
    eye.style.animation="blinkRobot 5s infinite";
    status.style.color="var(--primary)";
    status.innerText="// System_Standby";
  },2000);
}
</script>
</body>
</html>